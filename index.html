<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sales Comparison Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family:'Segoe UI',sans-serif;
    background:#f4f6f9;
    margin:20px;
}

h2{margin-bottom:15px;}

.filters{
    background:white;
    padding:15px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
    margin-bottom:20px;
}

select{
    padding:8px;
    margin:5px;
    border-radius:6px;
    border:1px solid #ccc;
}

.tabs{
    margin-top:20px;
}

.tab-btn{
    padding:8px 15px;
    border:none;
    margin-right:10px;
    cursor:pointer;
    border-radius:6px;
    background:#ddd;
}

.tab-btn.active{
    background:#111;
    color:white;
}

.tab-content{
    display:none;
    margin-top:20px;
}

.tab-content.active{
    display:block;
}

canvas{
    background:white;
    padding:15px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
    margin-bottom:20px;
}

.table-box{
    background:white;
    padding:15px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

table{
    width:100%;
    border-collapse:collapse;
}

th,td{
    padding:8px;
    text-align:center;
}

th{
    background:#111;
    color:white;
}
</style>
</head>

<body>

<h2>ðŸ“Š Sales Comparison Dashboard</h2>

<div class="filters">
<select id="store"><option value="">All Stores</option></select>
<select id="year"><option value="">All Years</option></select>
<select id="month"><option value="">All Months</option></select>
<select id="product"><option value="">All Products</option></select>
<select id="category"><option value="">All Categories</option></select>
</div>

<div class="tabs">
<button class="tab-btn active" onclick="openTab('monthTab')">Month Comparison</button>
<button class="tab-btn" onclick="openTab('yearTab')">Year Comparison</button>
<button class="tab-btn" onclick="openTab('rankTab')">Ranking</button>
</div>

<div id="monthTab" class="tab-content active">
<canvas id="monthComparisonChart"></canvas>
</div>

<div id="yearTab" class="tab-content">
<canvas id="yearComparisonChart"></canvas>
</div>

<div id="rankTab" class="tab-content">
<div class="table-box">
<div id="rankingTable"></div>
</div>
</div>

<h3>ðŸ“‹ Detailed Data</h3>
<div class="table-box">
<div id="detailTable"></div>
</div>

<script>

const SHEET_ID="151Stj3jdaqv-FG7CgOYGX87W8QEdDQJwzZNUY9t_aKE";
const URL=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?`;

let rawData=[];
let monthChart,yearChart;

const monthOrder=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

fetch(URL)
.then(res=>res.text())
.then(rep=>{
const json=JSON.parse(rep.substring(47).slice(0,-2));
const rows=json.table.rows;

rawData=rows.map(r=>({
store:r.c[0]?.v,
year:String(r.c[1]?.v),
month:r.c[2]?.v,
product:r.c[3]?.v,
category:r.c[4]?.v,
qty:Number(r.c[5]?.v)||0
})).filter(r=>r.store && r.qty>0);

initFilters();
});

function unique(arr){return [...new Set(arr)]}

function populate(id,values,label){
let sel=document.getElementById(id);
let current=sel.value;
sel.innerHTML=`<option value="">${label}</option>`;
values.sort().forEach(v=>{
if(v) sel.innerHTML+=`<option value="${v}">${v}</option>`;
});
sel.value=current;
}

function initFilters(){
populate("store",unique(rawData.map(d=>d.store)),"All Stores");
populate("year",unique(rawData.map(d=>d.year)),"All Years");
populate("month",unique(rawData.map(d=>d.month))
.sort((a,b)=>monthOrder.indexOf(a)-monthOrder.indexOf(b)),"All Months");
populate("product",unique(rawData.map(d=>d.product)),"All Products");
populate("category",unique(rawData.map(d=>d.category)),"All Categories");

document.querySelectorAll("select").forEach(s=>{
s.addEventListener("change",render);
});

render();
}

function sum(arr){return arr.reduce((a,b)=>a+b.qty,0)}

function render(){

let fStore=store.value;
let fYear=year.value;
let fMonth=month.value;
let fProduct=product.value;
let fCategory=category.value;

let data=rawData.filter(d=>{
return (!fStore||d.store==fStore)
&&(!fYear||d.year==fYear)
&&(!fMonth||d.month==fMonth)
&&(!fProduct||d.product==fProduct)
&&(!fCategory||d.category==fCategory);
});

drawMonthComparison(data,fMonth);
drawYearComparison(data,fYear);
buildRanking(data);
buildDetailTable(data);
}

function drawMonthComparison(data,month){

if(!month){
if(monthChart) monthChart.destroy();
return;
}

let years=unique(data.map(d=>d.year)).sort();
let values=years.map(y=>sum(data.filter(d=>d.year==y && d.month==month)));

if(monthChart) monthChart.destroy();

monthChart=new Chart(document.getElementById("monthComparisonChart"),{
type:"bar",
data:{
labels:years,
datasets:[{label:month+" Sales",data:values}]
},
options:{responsive:true}
});
}

function drawYearComparison(data,year){

if(!year){
if(yearChart) yearChart.destroy();
return;
}

let labels=monthOrder;
let values=labels.map(m=>sum(data.filter(d=>d.year==year && d.month==m)));

if(yearChart) yearChart.destroy();

yearChart=new Chart(document.getElementById("yearComparisonChart"),{
type:"bar",
data:{
labels:labels,
datasets:[{label:year+" Monthly Sales",data:values}]
},
options:{responsive:true}
});
}

function buildRanking(data){

let grouped={};
data.forEach(d=>{
if(!grouped[d.store]) grouped[d.store]=0;
grouped[d.store]+=d.qty;
});

let sorted=Object.entries(grouped).sort((a,b)=>b[1]-a[1]);

let html="<table><tr><th>Rank</th><th>Store Name</th><th>Total Sales</th></tr>";

sorted.forEach((s,i)=>{
html+=`<tr><td>${i+1}</td><td>${s[0]}</td><td>${s[1]}</td></tr>`;
});

html+="</table>";
rankingTable.innerHTML=html;
}

function buildDetailTable(data){

let html="<table><tr><th>Store Name</th><th>Year</th><th>Month</th><th>Product</th><th>Category</th><th>Quantity</th></tr>";

data.forEach(d=>{
html+=`<tr>
<td>${d.store}</td>
<td>${d.year}</td>
<td>${d.month}</td>
<td>${d.product}</td>
<td>${d.category}</td>
<td>${d.qty}</td>
</tr>`;
});

html+="</table>";
detailTable.innerHTML=html;
}

function openTab(tab){
document.querySelectorAll(".tab-content").forEach(t=>t.classList.remove("active"));
document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
document.getElementById(tab).classList.add("active");
event.target.classList.add("active");
}

</script>

</body>
</html>
